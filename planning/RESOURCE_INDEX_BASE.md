# Feature: Resource Index Base File

**Status:** Implemented (2026-01-12)
**Estimated Scope:** Small (~30-50 lines of code)
**Priority:** Enhancement

---

## Summary

Add automatic creation of a `Resource Index.base` file during PARA provisioning. This provides users with a ready-to-use Obsidian Bases database view of their Resources folder, showcasing the power of combining Quick PARA with the Bases core plugin.

---

## Requirements

1. **File Creation**: During provisioning, create `3 - RESOURCES/Resource Index.base`
2. **Three Views**:
   - **All Resources**: Shows name, description, tags columns
   - **Needs Description**: Filtered to show notes where `description` property is empty
   - **By Folder**: Grouped by parent folder (subfolder organization)
3. **Soft Dependency**: Show a notice suggesting Bases plugin installation; do not make it a hard requirement
4. **Read-Only Description**: Quick PARA never generates the `description` property - it only recognizes it exists and uses it in views

---

## Technical Analysis

### Current Provisioning Flow

The `ProvisioningManager` class in `src/index.js` (lines 167-216) handles folder creation:

```javascript
async provisionFolders(createMissingOnly = true) {
    const structure = await this.detectExistingStructure();
    const created = [];
    const skipped = [];
    // ... creates folders via this.app.vault.createFolder()
    return { created, skipped };
}
```

The `TemplateManager` class (lines 693-1282) handles file deployment with pattern:

```javascript
async deployTemplate(templateName, destination) {
    // Check if destination folder exists
    // Check if file already exists (skip if exists)
    // Create file via this.app.vault.create(destination, content)
}
```

### .base File Format (Obsidian Bases)

Based on [Obsidian Help documentation](https://help.obsidian.md/bases/syntax), `.base` files use YAML syntax:

```yaml
filters:
  and:
    - file.inFolder("3 - RESOURCES")

properties:
  description:
    displayName: Description

views:
  - type: table
    name: "All Resources"
    order:
      - file.name
      - note.description
      - note.tags
  - type: table
    name: "Needs Description"
    filters:
      or:
        - 'note.description = ""'
        - 'note.description = null'
    order:
      - file.name
      - note.tags
  - type: table
    name: "By Folder"
    group_by: "file.folder"
    order:
      - file.name
      - note.description
```

---

## Implementation Plan

### Task List

| # | Task | Scope | Notes |
|---|------|-------|-------|
| 1 | Define `RESOURCE_INDEX_BASE_CONTENT` constant | 5 lines | YAML string with three views |
| 2 | Add `deployResourceIndexBase()` method to TemplateManager | 15 lines | Similar to `deployTemplate()` pattern |
| 3 | Call from `provisionFolders()` after folder creation | 3 lines | Only if Resources folder created/exists |
| 4 | Add Bases plugin notice in Setup Wizard completion step | 5 lines | Suggest installing Bases to use the index |
| 5 | Update `deployAllTemplates()` to include Resource Index | 2 lines | Add to destinations map |

### File Changes

**`/Users/mriechers/Developer/obsidian-quick-para/src/index.js`**:
- Add `RESOURCE_INDEX_BASE_CONTENT` constant near line 700 (after template definitions)
- Add `deployResourceIndexBase()` method to `TemplateManager` class
- Modify `deployAllTemplates()` to include the .base file
- Add notice text to `renderConfirmStep()` in `SetupWizardModal`

---

## Resource Index Base Content

```yaml
# Resource Index - Auto-generated by Quick PARA
# Install the Bases core plugin to use this database view

filters:
  and:
    - file.inFolder("3 - RESOURCES")
    - 'file.ext = "md"'

properties:
  description:
    displayName: Description
  tags:
    displayName: Tags

views:
  - type: table
    name: "All Resources"
    order:
      - file.name
      - note.description
      - note.tags
      - file.cday
  - type: table
    name: "Needs Description"
    filters:
      or:
        - 'note.description = ""'
        - 'note.description = null'
    order:
      - file.name
      - note.tags
      - file.cday
  - type: table
    name: "By Folder"
    group_by: "file.folder"
    order:
      - file.name
      - note.description
```

---

## Edge Cases and Considerations

### 1. Bases Plugin Not Installed
- **Behavior**: File is created but won't render as database (shows as code/raw text)
- **Mitigation**: Notice on setup completion suggests installing Bases
- **User Impact**: Minimal - file is harmless if Bases not installed

### 2. Custom Resources Folder Path
- **Issue**: User may have renamed `3 - RESOURCES` to something else
- **Solution**: Use `this.settings.paraFolders.resources` for both:
  - Destination path: `${resourcesFolder}/Resource Index.base`
  - Filter in YAML: `file.inFolder("${resourcesFolder}")`

### 3. File Already Exists
- **Behavior**: Skip creation (same as templates)
- **Rationale**: Preserves user customizations to views

### 4. Description Property Semantics
- **Clarification**: Quick PARA does NOT auto-generate `description`
- **User Workflow**: Users manually add `description` property to resource notes
- **Base View**: "Needs Description" view helps identify notes lacking this property

### 5. Template Files in Resources
- **Issue**: TEMPLATES subfolder notes would appear in Resource Index
- **Solution**: Add filter to exclude TEMPLATES folder:
  ```yaml
  filters:
    and:
      - file.inFolder("3 - RESOURCES")
      - not:
        - file.inFolder("3 - RESOURCES/TEMPLATES")
  ```

---

## Testing Checklist

- [ ] Fresh provisioning creates Resource Index.base in correct location
- [ ] Re-running provisioning skips existing Resource Index.base
- [ ] Base file renders correctly with Bases plugin installed
- [ ] "All Resources" view shows expected columns
- [ ] "Needs Description" view filters correctly (empty description)
- [ ] "By Folder" view groups by subfolder
- [ ] Custom Resources folder path is respected
- [ ] TEMPLATES subfolder is excluded from views
- [ ] Notice appears suggesting Bases installation

---

## Dependencies

- **Obsidian Bases** (core plugin, optional): Required to render .base files as databases
- **No new npm dependencies**

---

## Implementation Notes

### Notice Text for Setup Wizard

Add to `renderConfirmStep()` after the "Next Steps" list:

```javascript
contentEl.createEl('h4', { text: 'Optional Enhancement' });
contentEl.createEl('p', {
    text: 'A Resource Index database view was created. Enable the Bases core plugin (Settings > Core plugins > Bases) to use it.',
    cls: 'setting-item-description'
});
```

### Dynamic Folder Path

The base content needs to use the actual configured folder path:

```javascript
getResourceIndexBaseContent() {
    const resourcesFolder = this.settings.paraFolders.resources;
    return `# Resource Index - Auto-generated by Quick PARA
filters:
  and:
    - file.inFolder("${resourcesFolder}")
    - not:
      - file.inFolder("${resourcesFolder}/TEMPLATES")
    - 'file.ext = "md"'
...`;
}
```

---

## Scope Estimate

| Component | Lines | Complexity |
|-----------|-------|------------|
| Base content template | 25 | Low |
| Deploy method | 15 | Low |
| Integration points | 10 | Low |
| **Total** | **~50** | **Low** |

This is a straightforward enhancement that follows existing patterns in the codebase.
